<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Excel 数据显示</title>
  <style>
    /* 全局盒模型调整 */
    * {
      box-sizing: border-box;
    }
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    h1 {
      text-align: center;
      font-size: 2em;
    }
    /* 当数据过长时，允许水平滚动 */
    #excelData {
      overflow-x: auto;
      margin: 0 auto;
      max-width: 100%;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }
    th,
    td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: left;
      word-wrap: break-word;
    }
    th {
      background-color: #f4f4f4;
    }
    tr:nth-child(even) {
      background-color: #fafafa;
    }
    /* 提示可排序的列增加指针效果 */
    th {
      cursor: default;
    }
    th.sortable {
      cursor: pointer;
    }
    .sort-indicator {
      font-size: 0.8em;
      margin-left: 5px;
    }
    /* 小屏幕自适应 */
    @media (max-width: 600px) {
      body {
        margin: 10px;
      }
      h1 {
        font-size: 1.5em;
      }
      th,
      td {
        padding: 8px;
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <h1>Excel 数据显示</h1>
  <div id="excelData">加载中...</div>
  
  <!-- 引入 SheetJS XLSX 库 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      let sortedColumn = null; // 当前排序的列（注意：实际序号与 Excel 数据中列索引有关）
      let sortOrderAsc = true; // 排序顺序，true 为正序
      let tableData = [];      // 用于存储完整表格数据（包含表头）

      // 读取 Excel 数据
      fetch("job_listings.xlsx")
        .then(function(response) {
          return response.arrayBuffer();
        })
        .then(function(data) {
          var workbook = XLSX.read(data, { type: 'array' });
          var firstSheetName = workbook.SheetNames[0];
          var worksheet = workbook.Sheets[firstSheetName];
          tableData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
          renderTable(tableData);
        })
        .catch(function(error) {
          console.error("读取 Excel 文件失败：", error);
          document.getElementById("excelData").innerHTML = "无法加载 Excel 数据。";
        });

      // 渲染表格函数
      function renderTable(data) {
        var container = document.getElementById("excelData");
        container.innerHTML = "";
        var table = document.createElement("table");

        data.forEach(function(row, rowIndex) {
          var tr = document.createElement("tr");
          // 利用 row.slice(1) 忽略第一列（序号），从第二列开始显示
          row.slice(1).forEach(function(cell, cellIndex) {
            let cellElement;
            if (rowIndex === 0) {
              // 表头使用 th 标签
              cellElement = document.createElement("th");
              let headerText = cell;
              // 判断是否为可排序的列
              if (headerText === "招聘编号" || headerText === "发布时间" || headerText === "截止日期") {
                cellElement.classList.add("sortable");
                // 添加点击事件：注意传入的 cellIndex+1 对应 Excel 中的实际列索引（因为第一列被忽略）
                cellElement.addEventListener("click", function() {
                  sortTableByColumn(cellIndex + 1, headerText);
                });
                // 设置默认的排序提示符（点击后可切换正序/倒序）
                var indicator = document.createElement("span");
                indicator.textContent = " ⇅";
                indicator.className = "sort-indicator";
                cellElement.appendChild(document.createTextNode(headerText));
                cellElement.appendChild(indicator);
              } else {
                cellElement.textContent = headerText;
              }
            } else {
              // 数据行使用 td 标签
              cellElement = document.createElement("td");
              cellElement.textContent = cell !== undefined ? cell : "";
            }
            tr.appendChild(cellElement);
          });
          table.appendChild(tr);
        });
        container.appendChild(table);
      }

      // 排序函数
      // 参数 columnIndex：实际根据 tableData 中的列索引来排序（注意：因为表格显示中第一列已被忽略，所以传入 cellIndex+1）
      // 参数 columnName：用于判断是否为日期列等特殊处理
      function sortTableByColumn(columnIndex, columnName) {
        // 如果同一列连续点击则切换排序顺序，否则设置为正序
        if (sortedColumn === columnIndex) {
          sortOrderAsc = !sortOrderAsc;
        } else {
          sortedColumn = columnIndex;
          sortOrderAsc = true;
        }
        // 获取表头和数据（不排序表头）
        let header = tableData[0];
        let dataRows = tableData.slice(1);

        dataRows.sort(function(a, b) {
          let valA = a[columnIndex] || "";
          let valB = b[columnIndex] || "";

          // 如果为日期列，尝试将字符串转换为日期进行比较
          if (columnName === "发布时间" || columnName === "截止日期") {
            let dateA = Date.parse(valA);
            let dateB = Date.parse(valB);
            if (!isNaN(dateA) && !isNaN(dateB)) {
              return sortOrderAsc ? dateA - dateB : dateB - dateA;
            }
          }

          // 如果两者都为数字，按数字比较
          let numA = parseFloat(valA);
          let numB = parseFloat(valB);
          if (!isNaN(numA) && !isNaN(numB)) {
            return sortOrderAsc ? numA - numB : numB - numA;
          }

          // 默认按字符串比较
          if (valA < valB) return sortOrderAsc ? -1 : 1;
          if (valA > valB) return sortOrderAsc ? 1 : -1;
          return 0;
        });

        // 重新组合数据（头部 + 排序后的数据行）并渲染表格
        tableData = [header].concat(dataRows);
        renderTable(tableData);
      }
    });
  </script>
</body>
</html>